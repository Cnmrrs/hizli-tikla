<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hƒ±zlƒ± Tƒ±kla! - Admin Pro</title>
    <style>
        /* --- GENEL AYARLAR --- */
        body {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, sans-serif;
            background-color: #2c3e50; overflow: hidden; user-select: none; touch-action: manipulation;
        }

        /* ARKA PLAN */
        #bg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            transition: background 0.5s;
        }
        .bg-default {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .bg-space { background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%); position: relative; }
        .bg-space::after {
            content: " . . . . . . . . . . . . . ";
            color: white; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            font-size: 50px; opacity: 0.3; overflow: hidden; word-wrap: break-word; letter-spacing: 50px; line-height: 100px;
            animation: moveStars 100s linear infinite;
        }
        @keyframes moveStars { from { transform: translateY(0); } to { transform: translateY(-1000px); } }

        .bg-matrix {
            background-color: black;
            background-image: linear-gradient(0deg, transparent 24%, rgba(0, 255, 0, .3) 25%, rgba(0, 255, 0, .3) 26%, transparent 27%, transparent 74%, rgba(0, 255, 0, .3) 75%, rgba(0, 255, 0, .3) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(0, 255, 0, .3) 25%, rgba(0, 255, 0, .3) 26%, transparent 27%, transparent 74%, rgba(0, 255, 0, .3) 75%, rgba(0, 255, 0, .3) 76%, transparent 77%, transparent);
            background-size: 50px 50px;
        }

        /* EKRANLAR */
        .game-screen {
            display: none; flex-direction: column; align-items: center; width: 100%; max-width: 600px;
            height: 100vh; position: relative; z-index: 10; justify-content: center;
        }

        .menu-card {
            background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); text-align: center; display: flex;
            flex-direction: column; align-items: center; gap: 12px; width: 90%; max-width: 400px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5);
            overflow-y: auto; max-height: 90vh;
        }

        .logo-container { width: 100px; height: 100px; position: relative; margin-bottom: 5px; animation: floatLogo 3s ease-in-out infinite; }
        .logo-circle { position: absolute; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .logo-outer { width: 100%; height: 100%; background: #e74c3c; box-shadow: 0 10px 20px rgba(231, 76, 60, 0.4); }
        .logo-middle { width: 70%; height: 70%; background: #fff; }
        .logo-inner { width: 40%; height: 40%; background: #e74c3c; }
        @keyframes floatLogo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        h1 { color: #2c3e50; font-size: 2.2em; margin: 5px 0 15px 0; font-weight: 900; text-transform: uppercase; }

        /* BUTONLAR */
        button {
            width: 100%; padding: 12px; font-size: 1.1em; cursor: pointer; color: white;
            border: none; border-radius: 12px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.1s; background: #34495e; position: relative; overflow: hidden;
        }
        button:active { transform: scale(0.95); }
        
        #play-button { background: linear-gradient(45deg, #2ecc71, #27ae60); font-size: 1.3em; padding: 15px; }
        #menu-shop-button { background: linear-gradient(45deg, #f1c40f, #f39c12); }
        #menu-quests-achievements-button { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        #menu-scores-button { background: linear-gradient(45deg, #3498db, #2980b9); }
        #menu-tutorial-button { background: #7f8c8d; font-size: 0.9em; }
        
        .bottom-actions { display: flex; gap: 10px; width: 100%; margin-top: 10px; }
        .bottom-actions button { font-size: 0.8em; padding: 10px; }
        #reset-data-button { background: #c0392b; border: 2px solid #e74c3c; }
        #admin-login-button { background: #2c3e50; border: 2px solid #34495e; }
        .btn-red { background: #e74c3c; margin-top: 10px; }

        /* OYUN ALANI */
        #top-info {
            width: 90%; display: flex; justify-content: space-between; background: white;
            padding: 10px 20px; border-radius: 15px; margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); box-sizing: border-box;
        }
        .stat-box { text-align: center; font-weight: bold; color: #34495e; }
        .stat-val { display: block; font-size: 1.4em; color: #e74c3c; }

        #power-status {
            height: 30px; width: 90%; margin-bottom: 5px; text-align: center;
            font-weight: bold; font-size: 1.2em; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            display: flex; justify-content: center; align-items: center; color: white;
        }

        #game-container {
            position: relative; width: 95vw; max-width: 550px; height: 60vh; max-height: 650px;
            background: rgba(255,255,255,0.95); border: 4px solid #34495e; border-radius: 20px; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); cursor: crosshair; z-index: 5;
        }

        .circle { position: absolute; border-radius: 50%; transform: scale(0); opacity: 0; transition: transform 0.1s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .circle.active { transform: scale(1); opacity: 1; }

        .skin-default { background: radial-gradient(circle at 30% 30%, #ff7675, #d63031); }
        .skin-blue { background: radial-gradient(circle at 30% 30%, #74b9ff, #0984e3); }
        .skin-green { background: radial-gradient(circle at 30% 30%, #55efc4, #00b894); }
        .skin-purple { background: radial-gradient(circle at 30% 30%, #a29bfe, #6c5ce7); }
        .skin-gold { background: radial-gradient(circle at 30% 30%, #ffeaa7, #fdcb6e); border: 3px solid #e17055; }
        .skin-pink { background: radial-gradient(circle at 30% 30%, #fd79a8, #e84393); }
        .skin-cyan { background: radial-gradient(circle at 30% 30%, #81ecec, #00cec9); }
        .skin-dark { background: radial-gradient(circle at 30% 30%, #636e72, #2d3436); border: 2px solid #fff; }
        .skin-rainbow { background: linear-gradient(135deg, red, orange, yellow, green, blue, indigo, violet); border: 2px solid white; }

        .bad { background: radial-gradient(circle at 30% 30%, #636e72, #2d3436); border: 3px solid #000; z-index: 5; }
        .boss { background: radial-gradient(circle at 30% 30%, #f1c40f, #e67e22); border: 4px solid #c0392b; z-index: 8; }
        .power-up { background: radial-gradient(circle at 30% 30%, #e056fd, #be2edd); box-shadow: 0 0 15px #e056fd; z-index: 6; }

        @keyframes explode { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
        .circle.explode { animation: explode 0.2s forwards; }

        #feedback, #score-pop, #countdown { position: absolute; pointer-events: none; font-weight: bold; z-index: 100; text-shadow: 1px 1px 2px white; }
        #countdown { font-size: 6em; color: #e74c3c; left: 50%; top: 50%; transform: translate(-50%, -50%); opacity: 0; }
        .particle-emoji { position: absolute; font-size: 24px; pointer-events: none; z-index: 20; animation: floatUp 1s forwards; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity:1; } 100% { transform: translateY(-50px) scale(1.5); opacity:0; } }

        #controls-area { width: 90%; max-width: 550px; margin-top: 15px; display: flex; flex-direction: column; gap: 10px; z-index: 20; }
        .input-row { display: flex; gap: 10px; }
        input, select { flex: 1; padding: 15px; border-radius: 12px; border: 1px solid #ccc; font-size: 1em; text-align: center; }

        /* MAƒûAZA */
        #shop-screen { display: none; flex-direction: column; justify-content: center; }
        .shop-card { background: white; border-radius: 20px; width: 90%; max-width: 500px; height: 80vh; display: flex; flex-direction: column; padding: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); box-sizing: border-box; }
        .shop-header { text-align: center; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 10px; flex-shrink: 0; }
        .shop-tabs { display: flex; gap: 5px; margin-bottom: 10px; flex-shrink: 0; }
        .shop-tab { flex: 1; padding: 8px; font-size: 0.9em; background: #eee; color: #555; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .shop-tab.active { background: #f1c40f; color: white; }
        #shop-list { flex: 1; overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; }
        .shop-footer { margin-top: 10px; border-top: 2px solid #eee; padding-top: 10px; flex-shrink: 0; }
        .shop-item { border: 1px solid #eee; border-radius: 10px; padding: 10px; text-align: center; background: #f9f9f9; display: flex; flex-direction: column; align-items: center; justify-content: space-between; }
        .shop-preview { width: 50px; height: 50px; border-radius: 50%; margin-bottom: 5px; display: flex; justify-content: center; align-items: center; font-size: 24px; border: 2px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .shop-desc { font-size: 0.75em; color: #777; margin-bottom: 5px; min-height: 30px; }
        .item-owned { border-color: #2ecc71; background: #eaffea; }

        /* Lƒ∞STELER */
        .scroll-content { flex: 1; overflow-y: auto; width: 100%; text-align: left; margin: 10px 0; }
        .list-item { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #bdc3c7; }
        .list-item.done { border-left-color: #2ecc71; }
        
        #sound-toggle { position: absolute; top: 20px; right: 20px; width: 50px; height: 50px; background: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5em; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 100; user-select: none; }
        
        .tab-container { display: flex; gap: 10px; width: 100%; margin-bottom: 10px; }
        .tab-btn { flex: 1; background: #eee; color: #555; padding: 10px; border: none; border-radius: 8px; font-weight: bold; }
        .tab-btn.active { background: #3498db; color: white; }

        #tutorial-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 200; }
        #tutorial-content { background: white; padding: 30px; border-radius: 15px; max-width: 400px; text-align: center; }

    </style>
</head>
<body>

    <div id="bg-layer" class="bg-default"></div>
    <div id="sound-toggle">üîä</div>

    <div id="main-menu" class="game-screen" style="display: flex;">
        <div class="menu-card">
            <div class="logo-container">
                <div class="logo-circle logo-outer"></div>
                <div class="logo-circle logo-middle"></div>
                <div class="logo-circle logo-inner"></div>
            </div>
            <h1>Hƒ±zlƒ± Tƒ±kla!</h1>
            <button id="play-button">‚ñ∫ OYUNA BA≈ûLA</button>
            <button id="menu-shop-button">üõçÔ∏è MAƒûAZA</button>
            <button id="menu-quests-achievements-button">üèÜ G√ñREVLER</button>
            <button id="menu-scores-button">üìä SKORLAR</button>
            <button id="menu-tutorial-button">‚ùì NASIL OYNANIR</button>
            
            <div class="bottom-actions">
                <button id="reset-data-button">‚ö†Ô∏è SIFIRLA</button>
                <button id="admin-login-button">üîë ADMƒ∞N</button>
            </div>
        </div>
    </div>

    <div id="game-area" class="game-screen">
        <div id="top-info">
            <div class="stat-box">PUAN <span class="stat-val" id="score">0</span></div>
            <div class="stat-box">S√úRE <span class="stat-val" id="timer">30</span></div>
            <div class="stat-box">PARA <span class="stat-val" id="coins">0</span></div>
        </div>
        
        <div id="power-status"></div>

        <div id="game-container">
            <div id="feedback"></div>
            <div id="score-pop"></div>
            <div id="countdown"></div>
        </div>

        <div id="controls-area">
            <div class="input-row">
                <input type="text" id="player-name" placeholder="Adƒ±n" maxlength="12">
                <select id="difficulty">
                    <option value="easy">Kolay</option>
                    <option value="medium" selected>Orta</option>
                    <option value="hard">Zor</option>
                </select>
            </div>
            <button id="start-game-button" style="background: #2ecc71;">BA≈ûLAT</button>
            <button id="initial-back-button" class="btn-red" onclick="showScreen('main-menu')">ANA MEN√úYE D√ñN</button>

            <div class="input-row" id="end-game-buttons" style="display: none;">
                <button id="reset-button" style="background: #f39c12;">TEKRAR</button>
                <button id="back-to-menu-button" style="background: #e74c3c;">√áIKI≈û</button>
            </div>
            <div style="display:flex; gap:10px; justify-content:center; color:white; font-size:0.9em;">
                <span id="shield-status">üõ°Ô∏è Kalkan: 0</span> | <span id="headstart-status">üöÄ Boost: 0</span>
            </div>
        </div>
    </div>

    <div id="shop-screen" class="game-screen">
        <div class="shop-card">
            <div class="shop-header">
                <h2>MAƒûAZA</h2>
                <div style="color:#f39c12; font-weight:bold;">Bakiye: <span id="shop-coin-display">0</span></div>
            </div>
            <div class="shop-tabs">
                <button class="shop-tab active" onclick="filterShop('cosmetic')">G√∂r√ºn√ºm</button>
                <button class="shop-tab" onclick="filterShop('upgrade')">Yetenek</button>
                <button class="shop-tab" onclick="filterShop('consumable')">Market</button>
            </div>
            <div id="shop-list"></div>
            <div class="shop-footer">
                <button class="btn-red" id="shop-back-button">ANA MEN√úYE D√ñN</button>
            </div>
        </div>
    </div>

    <div id="qa-screen" class="game-screen">
        <div class="menu-card" style="height: 80%;">
            <h2>G√ñREVLER</h2>
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('daily')">G√úNL√úK</button>
                <button class="tab-btn" onclick="switchTab('weekly')">HAFTALIK</button>
            </div>
            <div class="scroll-content" id="quest-list"></div>
            <button class="btn-red" id="quest-back-button">GERƒ∞ D√ñN</button>
        </div>
    </div>

    <div id="scores-screen" class="game-screen">
        <div class="menu-card" style="height: 80%;">
            <h2>EN ƒ∞Yƒ∞LER</h2>
            <div class="input-row" style="width:100%; margin-bottom:10px;">
                <button onclick="renderScores('all')" style="padding:10px; font-size:1em;">T√ºm Zamanlar</button>
                <button onclick="renderScores('weekly')" style="padding:10px; font-size:1em;">Haftalƒ±k</button>
            </div>
            <div class="scroll-content" id="score-list"></div>
            <button class="btn-red" id="score-back-button">GERƒ∞ D√ñN</button>
        </div>
    </div>

    <div id="tutorial-overlay">
        <div id="tutorial-content" class="menu-card">
            <h2 style="color:#2c3e50">Nasƒ±l Oynanƒ±r?</h2>
            <p>üî¥ <b>Kƒ±rmƒ±zƒ±larƒ±</b> patlat!</p>
            <p>‚ö´ <b>Siyahlara</b> dokunma!</p>
            <p>üü° <b>Boss</b> 3 vuru≈ü ister!</p>
            <p>üü£ <b>Mor</b> rastgele g√º√ß verir.</p>
            <button id="close-tutorial" style="background:#2980b9; margin-top:15px;">ANLADIM</button>
        </div>
    </div>

    <script>
        const AudioSys={ctx:null,enabled:true,init:function(){if(!this.ctx)this.ctx=new(window.AudioContext||window.webkitAudioContext)()},play:function(t){if(!this.enabled||!this.ctx)return;if(this.ctx.state==='suspended')this.ctx.resume();const o=this.ctx.createOscillator(),g=this.ctx.createGain();o.connect(g);g.connect(this.ctx.destination);const n=this.ctx.currentTime;if(t==='pop'){o.type='sine';o.frequency.setValueAtTime(600,n);o.frequency.exponentialRampToValueAtTime(300,n+0.1);g.gain.setValueAtTime(0.3,n);g.gain.exponentialRampToValueAtTime(0.01,n+0.1);o.start(n);o.stop(n+0.1)}else if(t==='bad'){o.type='sawtooth';o.frequency.setValueAtTime(150,n);o.frequency.linearRampToValueAtTime(50,n+0.3);g.gain.setValueAtTime(0.2,n);g.gain.linearRampToValueAtTime(0.01,n+0.3);o.start(n);o.stop(n+0.3)}else if(t==='coin'){o.type='square';o.frequency.setValueAtTime(800,n);o.frequency.exponentialRampToValueAtTime(1200,n+0.1);g.gain.setValueAtTime(0.1,n);g.gain.linearRampToValueAtTime(0.01,n+0.1);o.start(n);o.stop(n+0.1)}}};

        const SHOP_ITEMS = {
            cosmetic: [
                {id:'skin_def', type:'skin', name:'Klasik Top', price:0, owned:true, css:'skin-default', emoji:''},
                {id:'skin_blue', type:'skin', name:'Okyanus Top', price:500, owned:false, css:'skin-blue', emoji:''},
                {id:'skin_green', type:'skin', name:'Zehirli Top', price:750, owned:false, css:'skin-green', emoji:''},
                {id:'skin_pink', type:'skin', name:'≈ûeker Pembe', price:1000, owned:false, css:'skin-pink', emoji:''},
                {id:'skin_cyan', type:'skin', name:'Neon Turkuaz', price:1500, owned:false, css:'skin-cyan', emoji:''},
                {id:'skin_dark', type:'skin', name:'Gece Yarƒ±sƒ±', price:2000, owned:false, css:'skin-dark', emoji:''},
                {id:'skin_gold', type:'skin', name:'Altƒ±n Top', price:3000, owned:false, css:'skin-gold', emoji:''},
                {id:'skin_rb', type:'skin', name:'G√∂kku≈üaƒüƒ±', price:5000, owned:false, css:'skin-rainbow', emoji:''},
                {id:'bg_def', type:'bg', name:'Renkli Akƒ±≈ü', price:0, owned:true, css:'bg-default', emoji:'üåà'},
                {id:'bg_space', type:'bg', name:'Uzay Bo≈üluƒüu', price:750, owned:false, css:'bg-space', emoji:'üåå'},
                {id:'bg_matrix', type:'bg', name:'Matrix', price:800, owned:false, css:'bg-matrix', emoji:'üíª'},
                {id:'part_def', type:'part', name:'Normal Efekt', price:0, owned:true, val:'def', emoji:'‚ö™'},
                {id:'part_fire', type:'part', name:'Alev Efekti', price:600, owned:false, val:'üî•', emoji:'üî•'},
                {id:'part_money', type:'part', name:'Para Yaƒümuru', price:1000, owned:false, val:'üíµ', emoji:'üíµ'}
            ],
            upgrade: [
                {id:'upg_time', type:'upgrade', name:'Zaman Ustasƒ±', desc:'G√º√ßler 8sn s√ºrer', price:5000, owned:false, emoji:'‚è≥'},
                {id:'upg_coin', type:'upgrade', name:'Para Mƒ±knatƒ±sƒ±', desc:'2X Para Kazan', price:8000, owned:false, emoji:'üß≤'},
                {id:'upg_boss', type:'upgrade', name:'Boss Celladƒ±', desc:'Boss 2 vuru≈üta √∂l√ºr', price:6000, owned:false, emoji:'‚öîÔ∏è'}
            ],
            consumable: [
                {id:'con_shield', type:'consumable', name:'Kalkan', desc:'1 Hatadan Korur', price:250, count:0, emoji:'üõ°Ô∏è'},
                {id:'con_head', type:'consumable', name:'Hƒ±zlƒ± Ba≈ülangƒ±√ß', desc:'+5sn ile Ba≈üla', price:300, count:0, emoji:'üöÄ'}
            ]
        };
        
        let state = { score:0, coins:0, time:30, active:false, activePower: null, equipped: { skin:'skin_def', bg:'bg_def', part:'part_def' } };
        let activeCircles=[], spawnTimeout, timerInterval, powerTimeout;
        let quests = { daily: [], weekly: [] };
        let currentShopFilter = 'cosmetic';
        let currentQuestView = 'daily';

        const els={screens:document.querySelectorAll('.game-screen'),score:document.getElementById('score'),time:document.getElementById('timer'),coin:document.getElementById('coins'),gameCont:document.getElementById('game-container'),shopCoins:document.getElementById('shop-coin-display'),powerStatus:document.getElementById('power-status')};

        function init(){
            try {
                state.coins = parseInt(localStorage.getItem('coins')) || 0;
                const savedShop = JSON.parse(localStorage.getItem('shopInventory'));
                if(savedShop) {
                    ['cosmetic','upgrade','consumable'].forEach(cat => {
                        if(SHOP_ITEMS[cat]) {
                            SHOP_ITEMS[cat].forEach(item => {
                                const savedItem = savedShop[cat]?.find(x => x.id === item.id);
                                if(savedItem) {
                                    if(item.type === 'consumable') item.count = savedItem.count;
                                    else item.owned = savedItem.owned;
                                }
                            });
                        }
                    });
                }
                const savedEquip = JSON.parse(localStorage.getItem('equipped'));
                if(savedEquip) state.equipped = savedEquip;
                
                const d = new Date().toDateString();
                const w = Math.floor(Date.now() / 604800000);
                if(localStorage.getItem('qDate') !== d) {
                    quests.daily = generateRandomQuests(3,1);
                    localStorage.setItem('dailyQ', JSON.stringify(quests.daily));
                    localStorage.setItem('qDate', d);
                } else quests.daily = JSON.parse(localStorage.getItem('dailyQ')) || [];

                if(localStorage.getItem('qWeek') != w) {
                    quests.weekly = generateRandomQuests(5,5);
                    localStorage.setItem('weeklyQ', JSON.stringify(quests.weekly));
                    localStorage.setItem('qWeek', w);
                } else quests.weekly = JSON.parse(localStorage.getItem('weeklyQ')) || [];

            } catch(e) { localStorage.clear(); }

            applyBackground();
            updateUI(); setupEvents();
            document.body.addEventListener('click',()=>AudioSys.init(),{once:true});
        }

        function generateRandomQuests(count, mult) {
            const tpls = [
                {txt:"X Kere Tƒ±kla", t:"clicks", min:30, max:80},
                {txt:"X Boss Yen", t:"boss", min:2, max:6},
                {txt:"X Puan Yap", t:"points", min:300, max:800},
                {txt:"X Kez Yan", t:"fails", min:3, max:10},
                {txt:"X Para Biriktir", t:"coins_earned", min:50, max:150}
            ];
            let res = [];
            for(let i=0;i<count;i++){
                let t = tpls[Math.floor(Math.random()*tpls.length)];
                let val = Math.floor((Math.random()*(t.max-t.min)+t.min)*mult);
                res.push({desc:t.txt.replace('X',val), target:val, curr:0, reward:Math.floor(val*(mult==1?1.5:0.8)), done:false, collected:false, type:t.t});
            }
            return res;
        }

        function setupEvents(){
            document.getElementById('play-button').onclick=()=>showScreen('game-area');
            document.getElementById('menu-shop-button').onclick=()=>{showScreen('shop-screen');renderShop()};
            document.getElementById('menu-quests-achievements-button').onclick=()=>{showScreen('qa-screen');renderQuests()};
            document.getElementById('menu-scores-button').onclick=()=>{showScreen('scores-screen');renderScores('all')};
            document.getElementById('menu-tutorial-button').onclick=()=>document.getElementById('tutorial-overlay').style.display='flex';
            document.getElementById('close-tutorial').onclick=()=>document.getElementById('tutorial-overlay').style.display='none';
            
            // SIFIRLA VE ADMIN (YENƒ∞ Hƒ∞LE EKLENDƒ∞)
            document.getElementById('reset-data-button').onclick=()=>{ 
                if(confirm("T√ºm ilerlemen silinecek! Emin misin?")) { localStorage.clear(); location.reload(); } 
            };
            document.getElementById('admin-login-button').onclick=()=>{ 
                const input = prompt("Admin Komutu:");
                if(input.startsWith('!')) {
                    const amount = parseInt(input.substring(1));
                    if(!isNaN(amount)) {
                        state.coins += amount;
                        saveData(); updateUI();
                        alert(`${amount} Para Eklendi!`);
                    } else {
                        alert("Ge√ßersiz kod!");
                    }
                } else if(input === 'NPM5') {
                     // Eski kod desteƒüi
                     state.coins = 9999999;
                     saveData(); updateUI(); alert("Sƒ±nƒ±rsƒ±z Para!");
                } else {
                    alert("Hatalƒ±!");
                }
            };

            document.getElementById('shop-back-button').onclick=()=>showScreen('main-menu');
            document.getElementById('quest-back-button').onclick=()=>showScreen('main-menu');
            document.getElementById('score-back-button').onclick=()=>showScreen('main-menu');
            document.getElementById('initial-back-button').onclick=()=>showScreen('main-menu');
            document.getElementById('back-to-menu-button').onclick=()=>{stopGame();showScreen('main-menu')};
            
            document.getElementById('start-game-button').onclick=startGame;
            document.getElementById('reset-button').onclick=startGame;
            document.getElementById('sound-toggle').onclick=(e)=>{AudioSys.enabled=!AudioSys.enabled;e.target.textContent=AudioSys.enabled?'üîä':'üîá';if(AudioSys.enabled)AudioSys.init()};
            
            document.getElementById('menu-shop-button').addEventListener('click', renderShop);
        }

        function showScreen(id){els.screens.forEach(s=>s.style.display='none');document.getElementById(id).style.display='flex';}
        
        function updateUI(){
            els.coin.textContent=state.coins; els.shopCoins.textContent=state.coins;
            const shield = SHOP_ITEMS.consumable.find(x=>x.id==='con_shield');
            const head = SHOP_ITEMS.consumable.find(x=>x.id==='con_head');
            if(shield) document.getElementById('shield-status').textContent = `üõ°Ô∏è Kalkan: ${shield.count}`;
            if(head) document.getElementById('headstart-status').textContent = `üöÄ Boost: ${head.count}`;
        }

        function startGame(){
            if(state.active)return;
            state.active=true; state.score=0; state.activePower = null; els.powerStatus.textContent = '';
            const diff=document.getElementById('difficulty').value;
            
            let boost = 0;
            const boostItem = SHOP_ITEMS.consumable.find(x=>x.id==='con_head');
            if(boostItem && boostItem.count > 0) { boostItem.count--; boost = 5; saveData(); }

            state.time = (diff==='easy'?45:(diff==='hard'?20:30)) + boost;
            
            activeCircles.forEach(c=>c.remove()); activeCircles=[];
            els.score.textContent='0'; els.time.textContent=state.time;
            document.getElementById('start-game-button').style.display='none';
            document.getElementById('initial-back-button').style.display='none';
            document.getElementById('end-game-buttons').style.display='none';
            document.getElementById('difficulty').disabled=true;
            document.getElementById('player-name').disabled=true;
            updateUI();

            scheduleNextSpawn();
            timerInterval=setInterval(()=>{
                state.time--; els.time.textContent=state.time;
                if(state.time<=0)endGame();
            },1000);
        }

        function scheduleNextSpawn(){
            if(!state.active) return;
            const diff = document.getElementById('difficulty').value;
            let delay = diff==='easy' ? 1200 : (diff==='hard' ? 600 : 900); 
            delay = Math.random() * 400 + delay;
            spawnTimeout = setTimeout(() => { spawnCircle(); scheduleNextSpawn(); }, delay);
        }

        function spawnCircle(){
            if(activeCircles.length>5)return;
            
            const diff = document.getElementById('difficulty').value;
            let baseSize = diff==='hard' ? 40 : 60;
            if(state.activePower === 'giant') baseSize *= 1.5;

            const maxTries=10; let x, y, valid=false;
            for(let i=0; i<maxTries; i++){
                x = Math.random() * (els.gameCont.offsetWidth - baseSize);
                y = Math.random() * (els.gameCont.offsetHeight - baseSize);
                let collision = activeCircles.some(c => {
                    let cx = parseFloat(c.style.left), cy = parseFloat(c.style.top);
                    let dist = Math.sqrt(Math.pow(x-cx,2)+Math.pow(y-cy,2));
                    return dist < baseSize + 10;
                });
                if(!collision) { valid=true; break; }
            }
            if(!valid) return;

            const r=Math.random();
            let type='good'; if(r<0.2)type='bad';else if(r<0.25)type='power-up';else if(r<0.3)type='boss';
            
            const el=document.createElement('div');
            let css=type==='good' ? getSkinClass() : type;
            el.className=`circle ${css}`;
            el.style.left=x+'px'; el.style.top=y+'px';
            el.style.width=baseSize+'px'; el.style.height=baseSize+'px';
            el.dataset.type=type; 
            if(type==='boss') {
                const slayer = SHOP_ITEMS.upgrade.find(u=>u.id==='upg_boss').owned;
                el.dataset.hp = slayer ? 2 : 3; 
            }

            const hit=(e)=>{e.preventDefault();e.stopPropagation();hitCircle(el)};
            el.addEventListener('touchstart',hit); el.addEventListener('mousedown',hit);

            els.gameCont.appendChild(el); activeCircles.push(el);
            requestAnimationFrame(()=>el.classList.add('active'));

            let stay=diff==='hard'?1000:1600;
            setTimeout(()=>{
                if(el.parentNode){
                    if(type !== 'bad') { showText(el, 'KA√áIRDIN!', '#e74c3c'); updateQuest('fails', 1); }
                    removeCircle(el);
                }
            },stay);
        }

        function getSkinClass() { const s = SHOP_ITEMS.cosmetic.find(x=>x.id===state.equipped.skin); return s ? s.css : 'skin-default'; }

        function hitCircle(el){
            const type=el.dataset.type;
            updateQuest('clicks',1); let pts=0;

            if(type==='bad'){
                const shield = SHOP_ITEMS.consumable.find(x=>x.id==='con_shield');
                if(shield && shield.count > 0) {
                    shield.count--; AudioSys.play('pop'); showText(el, 'KURTULDUN!', '#3498db'); saveData(); updateUI();
                } else {
                    state.score-=5; AudioSys.play('bad'); showText(el,'-5','red'); updateQuest('fails',1);
                }
            } else if(type==='boss'){
                let hp=parseInt(el.dataset.hp)-1;el.dataset.hp=hp;
                el.style.transform=`scale(${1+(0.2*(3-hp))})`; AudioSys.play('pop');
                if(hp>0)return;
                pts=10; updateQuest('boss',1); AudioSys.play('coin'); showText(el,'BOSS!','gold');
                spawnParticle(el);
            } else if(type==='power-up'){
                const powers = ['time', 'double', 'giant'];
                const chosen = powers[Math.floor(Math.random() * powers.length)];
                AudioSys.play('coin');
                if(chosen === 'time') { state.time+=5; showText(el,'+5sn','purple'); }
                else if(chosen === 'double') { activatePower('double'); showText(el, '2X PUAN', 'orange'); }
                else if(chosen === 'giant') { activatePower('giant'); showText(el, 'DEV MOD', 'cyan'); }
            } else {
                pts=1; AudioSys.play('pop'); showText(el,'+1','#2ecc71'); spawnParticle(el);
            }
            
            if(state.activePower === 'double' && pts > 0) pts *= 2;
            state.score+=pts; 
            if(pts>0) { 
                let gain=1; if(SHOP_ITEMS.upgrade.find(u=>u.id==='upg_coin').owned) gain=2;
                state.coins+=gain; updateQuest('coins_earned', gain); 
            }
            if(state.score>=500) updateQuest('points',500);
            els.score.textContent=state.score; updateUI(); removeCircle(el,true);
        }

        function spawnParticle(el) {
            const pItem = SHOP_ITEMS.cosmetic.find(x=>x.id === state.equipped.part);
            if(!pItem || pItem.val === 'def') return;
            const p = document.createElement('div'); p.textContent = pItem.val;
            p.className = 'particle-emoji'; p.style.left = el.style.left; p.style.top = el.style.top;
            els.gameCont.appendChild(p); setTimeout(()=>p.remove(), 1000);
        }

        function activatePower(type) {
            state.activePower = type; clearTimeout(powerTimeout);
            els.powerStatus.textContent = type === 'double' ? '‚ö° 2X PUAN AKTƒ∞F!' : 'üîµ DEV MOD AKTƒ∞F!';
            const dur = SHOP_ITEMS.upgrade.find(u=>u.id==='upg_time').owned ? 8000 : 5000;
            powerTimeout = setTimeout(() => { state.activePower = null; els.powerStatus.textContent = ''; }, dur);
        }

        function removeCircle(el,clicked=false){
            el.classList.remove('active'); if(clicked)el.classList.add('explode');
            setTimeout(()=>{if(el.parentNode)el.remove()},200); activeCircles=activeCircles.filter(c=>c!==el);
        }

        function endGame(){
            stopGame(); AudioSys.play('bad'); alert(`S√ºre Doldu! Puan: ${state.score}`);
            saveScore(state.score); saveData();
            document.getElementById('end-game-buttons').style.display='flex';
            document.getElementById('difficulty').disabled=false; document.getElementById('player-name').disabled=false;
        }

        function stopGame(){
            state.active=false; clearTimeout(spawnTimeout); clearInterval(timerInterval);
            activeCircles.forEach(c=>c.remove()); activeCircles=[]; state.activePower = null; els.powerStatus.textContent = '';
        }

        function showText(el,txt,col){
            const f=document.getElementById('feedback'); f.textContent=txt; f.style.color=col;
            f.style.left=el.style.left; f.style.top=el.style.top; f.style.opacity=1; f.style.transform='translateY(0)';
            f.style.transition='none'; requestAnimationFrame(()=>{f.style.transition='all 0.5s';f.style.transform='translateY(-40px)';f.style.opacity=0});
        }

        window.filterShop = (cat) => {
            currentShopFilter = cat;
            document.querySelectorAll('.shop-tab').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderShop();
        }

        function renderShop(){
            const list = document.getElementById('shop-list'); list.innerHTML = '';
            const items = SHOP_ITEMS[currentShopFilter];
            items.forEach(item => {
                const div = document.createElement('div'); div.className = 'shop-item';
                let btnTxt, btnBg, onClick;
                if(item.type === 'consumable') {
                    btnTxt = `${item.price} üí∞ (${item.count})`; btnBg = '#f1c40f'; onClick = `buyItem('${item.type}', '${item.id}')`;
                } else if (item.type === 'upgrade') {
                    btnTxt = item.owned ? 'SAHƒ∞PLƒ∞' : `${item.price} üí∞`; btnBg = item.owned ? '#7f8c8d' : '#e67e22'; onClick = item.owned ? '' : `buyItem('${item.type}', '${item.id}')`;
                } else {
                    const isEq = state.equipped[item.type] === item.id;
                    btnTxt = item.owned ? (isEq ? 'SE√áƒ∞Lƒ∞' : 'SE√á') : `${item.price} üí∞`;
                    btnBg = item.owned ? (isEq ? '#7f8c8d' : '#2ecc71') : '#f1c40f';
                    onClick = `buyItem('${item.type}', '${item.id}')`;
                }
                let preview = `<div class="shop-preview ${item.css || ''}">${item.emoji || ''}</div>`;
                div.innerHTML = `${preview}<h4>${item.name}</h4><div class="shop-desc">${item.desc||''}</div><button style="background:${btnBg};padding:5px;font-size:0.8em;width:100%;border-radius:8px;border:none;color:white;" onclick="${onClick}">${btnTxt}</button>`;
                if(item.owned || item.count > 0) div.classList.add('item-owned');
                list.appendChild(div);
            });
        }

        window.buyItem = (cat, id) => {
            let group = cat === 'skin' || cat === 'bg' || cat === 'part' ? 'cosmetic' : cat;
            let item = SHOP_ITEMS[group].find(x => x.id === id);
            if(item.type === 'consumable') {
                if(state.coins >= item.price) { state.coins -= item.price; item.count++; AudioSys.play('coin'); } else { AudioSys.play('bad'); alert('Yetersiz Bakiye'); }
            } else if(item.owned) {
                if(group === 'cosmetic') { state.equipped[item.type] = id; if(item.type === 'bg') applyBackground(); }
            } else {
                if(state.coins >= item.price) { state.coins -= item.price; item.owned = true; if(group === 'cosmetic') { state.equipped[item.type] = id; if(item.type === 'bg') applyBackground(); } AudioSys.play('coin'); } else { AudioSys.play('bad'); alert('Yetersiz Bakiye'); }
            }
            saveData(); updateUI(); renderShop();
        };

        function applyBackground() {
            const bgItem = SHOP_ITEMS.cosmetic.find(x => x.id === state.equipped.bg);
            const bgLayer = document.getElementById('bg-layer');
            bgLayer.className = ''; // Sƒ±fƒ±rla
            if(bgItem) { bgLayer.classList.add(bgItem.css); } else { bgLayer.classList.add('bg-default'); }
        }

        function saveData() {
            localStorage.setItem('coins', state.coins);
            localStorage.setItem('shopInventory', JSON.stringify(SHOP_ITEMS));
            localStorage.setItem('equipped', JSON.stringify(state.equipped));
            localStorage.setItem('dailyQ', JSON.stringify(quests.daily));
            localStorage.setItem('weeklyQ', JSON.stringify(quests.weekly));
        }

        window.switchTab = (tab) => { currentQuestView = tab; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); event.target.classList.add('active'); renderQuests(); }
        function renderQuests(){
            const list=document.getElementById('quest-list'); list.innerHTML='';
            const arr = currentQuestView === 'daily' ? quests.daily : quests.weekly;
            arr.forEach((q,i)=>{
                const btn=q.done&&!q.collected?`<button onclick="claimQ(${i})" style="background:#f1c40f;margin-top:5px;padding:5px;">√ñd√ºl (${q.reward})</button>`:'';
                const st=q.collected?'‚úÖ':`${q.curr}/${q.target}`;
                list.innerHTML+=`<div class="list-item ${q.done?'done':''}"><b>${q.desc}</b><br>${st}${btn}</div>`;
            });
        }
        window.claimQ=(i)=>{ const arr = currentQuestView === 'daily' ? quests.daily : quests.weekly; arr[i].collected=true; state.coins+=arr[i].reward; AudioSys.play('coin'); saveData(); updateUI(); renderQuests(); };
        function updateQuest(t,v){ ['daily','weekly'].forEach(cat=>{ quests[cat].forEach(q=>{ if(q.type===t){ if(!q.done)q.curr+=v; if(q.curr>=q.target)q.done=true; }}); }); saveData(); }
        
        function saveScore(s){
            const n=document.getElementById('player-name').value||'Oyuncu'; const d=document.getElementById('difficulty').value;
            let w=JSON.parse(localStorage.getItem('sw'))||[]; w.push({name:n,score:s,diff:d}); w.sort((a,b)=>b.score-a.score);
            let a=JSON.parse(localStorage.getItem('sa'))||[]; a.push({name:n,score:s,diff:d}); a.sort((x,y)=>y.score-x.score);
            localStorage.setItem('sw',JSON.stringify(w.slice(0,10))); localStorage.setItem('sa',JSON.stringify(a.slice(0,10)));
        }
        window.renderScores=(t)=>{
            const list=document.getElementById('score-list'); list.innerHTML='';
            const d=JSON.parse(localStorage.getItem(t==='weekly'?'sw':'sa'))||[];
            if(!d.length)list.innerHTML='<p style="text-align:center">Yok</p>';
            d.forEach((s,i)=>list.innerHTML+=`<div class="list-item"><b>${i+1}. ${s.name}</b> (${s.diff}) <span style="float:right;color:#e74c3c">${s.score}</span></div>`);
        }

        init();
    </script>
</body>
</html>